#!/bin/bash

echo 'Updating vim plugins'
cd "$HOME/.dotfiles/link/.vim/bundle"
for i in `ls`; do
  echo $i
  cd "$i"
  git pull
  cd ..
  echo
done

echo 'Updating fuzzdb'
if [[ -e "$HOME/tools/burp/fuzzdb" ]]; then
  cd "$HOME/tools/burp/fuzzdb"
  git pull
else
  cd "$HOME/tools/burp"
  git clone https://github.com/fuzzdb-project/fuzzdb.git
fi

echo 'Updating knockknock'
if [[ -e "$HOME/.dotfiles/bin/knockknock" ]]; then
  cd "$HOME/.dotfiles/bin/knockknock"
  git pull
else
  cd "$HOME/.dotfiles/bin/"
  git clone https://github.com/synack/knockknock.git
fi

echo 'Updating testssl'
if [[ -e "$HOME/.dotfiles/bin/testssl.sh" ]]; then
  cd "$HOME/.dotfiles/bin/testssl.sh"
  git pull
else
  cd "$HOME/.dotfiles/bin/"
  git clone https://github.com/drwetter/testssl.sh.git
fi

echo; echo 'Running brew update, upgrade, cleanup and checkup'
brew update && brew upgrade --all && brew upgrade brew-cask 
brew cleanup && brew cask cleanup && brew doctor

echo; echo 'Updating pip and pip packages'
pip install --upgrade pip setuptools
pip install -U pyobjc
pip3 install -U peewee
# This updates the System modules... probably not the best idea
#pip freeze --local | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip install -U

#echo; echo 'update gems'
#gem update --system

echo; echo 'Updating karabiner/seil sets'
/Applications/Karabiner.app/Contents/Library/bin/karabiner export > "$HOME/.dotfiles/conf/osx/key-bindings/karabiner-import.sh"
/Applications/Seil.app/Contents/Library/bin/seil export > "$HOME/.dotfiles/conf/osx/key-bindings/seil-import.sh"

if [[ -e "$HOME/.dotfiles/bin/update_local" ]]; then
  source "$HOME/.dotfiles/bin/update_local"
fi

sudo softwareupdate --install --all
